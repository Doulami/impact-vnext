# Milestones & Acceptance Criteria\n\n## M1: Repo & Docs Baseline ✓\n**Status**: Complete  \n**Deliverables**:\n- [x] Monorepo structure (apps, packages, docs)\n- [x] Root README with stack overview & feature flags\n- [x] .env.example with all service placeholders\n- [x] Architecture overview (stack-overview.md)\n- [x] StoreConfig spec (store-config.md)\n- [x] Storefront page map (storefront-page-map.md)\n- [x] Feature specs: payments, shipping, loyalty, search, perf/PWA, admin (M8)\n- [x] Runbooks: ops, QA checklist\n- [x] Placeholder READMEs for each app/package\n- [x] This milestones document\n\n**Acceptance**: All documentation complete; team aligned on architecture & feature set.\n\n---\n\n## M2: Storefront Shells & PWA Baseline\n**Timeline**: 2–3 weeks  \n**Priority**: High (revenue-blocking)\n\n### Deliverables\n- **Next.js app** (apps/web):\n  - Homepage, collection (PLP), product (PDP), cart, checkout (multi-step), account (login/register), content pages\n  - Demo products from Vendure (hardcoded initially)\n  - PWA manifest + service worker skeleton (offline shell for PDP + cart)\n  - Responsive design (mobile-first)\n  - ISR config on PLP/PDP (revalidate 600–1800s)\n  - Next/Image optimization for product photos\n  - Structured data (Schema.org) for home, PLP, PDP\n\n- **Vendure setup** (apps/api):\n  - GraphQL Shop schema (products, collections, cart, orders)\n  - Demo catalog (5 products, 2 collections)\n  - Payment & shipping resolver stubs (feature-gated)\n\n- **Strapi setup** (apps/cms):\n  - StoreConfig single-type with all feature flags (all OFF except payments.gpgEnabled=true)\n  - Demo content (hero banners, promo bars)\n  - Editorial collections (header/footer menus)\n\n- **Feature flags wired**:\n  - feature-flags SDK (reads from Strapi)\n  - Web conditionally renders payment methods, loyalty UI, search (Meili vs. fallback)\n  - Flags cacheable (5–10 min in API, 30 min browser)\n\n### Acceptance Criteria\n- [ ] Storefront loads home, PLP, PDP, cart without errors\n- [ ] Feature flags read from Strapi on startup\n- [ ] Payment methods show/hide based on `payments.gpgEnabled`\n- [ ] Loyalty section hidden when flag OFF\n- [ ] PWA manifest valid; service worker registered\n- [ ] Offline mode shows cached PDP shell\n- [ ] SEO: all pages have title, meta description, structured data\n- [ ] Mobile: responsive on 320px, 768px, 1024px viewports\n- [ ] Core browse → cart → checkout flow works with demo data\n- [ ] QA: ON/OFF matrix passes (see qa-checklist.md)\n\n---\n\n## M3: Payments (GPG Checkout) End-to-End\n**Timeline**: 2 weeks  \n**Priority**: High (revenue-blocking)\n\n### Deliverables\n- **GPG Payment Provider** (packages/payments-gpg):\n  - Vendure plugin integrating GPG provider\n  - Checkout handler: generate signed redirect URL\n  - Webhook handler: `/webhooks/gpg` (authorized, captured, failed, refunded events)\n  - Signature validation (HMAC SHA256)\n  - Idempotency key (prevent duplicate charges)\n  - Error messaging (card declined, timeout, network)\n\n- **Vendure integration**:\n  - Payment state machine: Authorized → Captured (or Failed)\n  - Order transitions on payment success\n  - Webhook retry logic (3 attempts, 24h window)\n  - Logging: all payment events\n\n- **Storefront**:\n  - Checkout payment step shows GPG option (if `payments.gpgEnabled`)\n  - Redirect to GPG hosted page on \"Pay Now\"\n  - Handle returnUrl (success) and cancelUrl (failure)\n  - Confirmation page shows payment status\n\n- **Testing**:\n  - Sandbox mode with GPG test keys\n  - Mock webhook tests (success, fail, refund)\n  - Signature validation tests\n\n### Acceptance Criteria\n- [ ] Create order → redirect to GPG hosted page\n- [ ] GPG payment succeeds → order marked \"Paid\"\n- [ ] GPG payment fails → order marked \"Failed\"; clear error message to customer\n- [ ] Webhook received → payment state updated within 5s\n- [ ] Duplicate webhook → idempotent (no double-charge)\n- [ ] Webhook failure → retry 3 times; log all attempts\n- [ ] Signature validation fails → reject webhook; alert ops\n- [ ] Refund webhook → order transitions to \"Refunded\"; email sent\n- [ ] Manual capture (future M8 admin UI): stub endpoint exists\n- [ ] Reconciliation runbook: all steps documented, tested\n- [ ] Payment flag OFF → GPG option hidden; checkout still works\n- [ ] Sandbox: test all scenarios with 100% success rate\n\n---\n\n## M4: Shipping File Bridge\n**Timeline**: 2 weeks  \n**Priority**: High (revenue-blocking)\n\n### Deliverables\n- **Shipping File Bridge** (packages/shipping-file):\n  - Vendure plugin: listen to \"Ready to Ship\" order state\n  - Scheduled export: cron job (from SHIP_EXPORT_SCHEDULE env var)\n  - Manual export: admin endpoint `/admin/orders/export-shipping`\n  - File generation: CSV/TSV with order data (see shipping-file-bridge.md)\n  - SFTP/HTTPS transport: upload to remote (retry 3x, 30s backoff)\n  - Order metadata: mark exported_at, batch_id, file_path\n  - Logging: all export events, batch status, errors\n\n- **Admin UI (stubs)**:\n  - View export batches + status\n  - Re-export button (manual)\n  - Download export log\n\n### Acceptance Criteria\n- [ ] Scheduled export runs at configured time; exports all \"Ready to Ship\" orders\n- [ ] Manual export triggered; file generated & uploaded\n- [ ] Export file has correct columns & data (sample order exported correctly)\n- [ ] Order marked with export metadata after success\n- [ ] Upload failure → retry 3 times; batch marked \"Failed\" after 3 failures\n- [ ] Re-export: order marked \"superseded\"; new batch created\n- [ ] SFTP connection: auth works (user/pass or SSH key)\n- [ ] HTTPS fallback: multipart form-data upload succeeds\n- [ ] Logging: all events logged (export start, upload, failure, retry)\n- [ ] Shipping flag OFF → no auto-export; manual export disabled\n- [ ] Runbook: ops can manually export & re-export; test successful\n\n---\n\n## M5: Loyalty (Earn/Burn + Account Surfaces)\n**Timeline**: 2 weeks  \n**Priority**: Medium\n\n### Deliverables\n- **Loyalty Module** (packages/loyalty):\n  - Vendure plugin: listen to \"Order Paid\" event\n  - Earn logic: calculate points (% of net order amount)\n  - Burn logic: apply discount at checkout (capped % of subtotal)\n  - Ledger: store all transactions (awarded, redeemed, adjusted)\n  - Refund handling: reverse points on order refund\n\n- **Account surfaces** (apps/web):\n  - /account/loyalty: balance display, transaction history, redeem form\n  - Checkout: loyalty input (if flag enabled) + discount preview\n  - Order confirmation email: \"You earned X points\" message\n\n- **API**:\n  - GraphQL queries: customer loyalty balance, ledger history\n  - Mutations: redeem loyalty points\n\n### Acceptance Criteria\n- [ ] Order paid → loyalty points awarded (ledger entry created)\n- [ ] Earn rate correct: 1% = 100 points per $100 (configurable)\n- [ ] Net amount calculated correctly: subtotal + tax − discounts (exclude shipping)\n- [ ] Checkout: redeem form calculates discount correctly (1 point = $0.01)\n- [ ] Max redeem: capped at 50% of order subtotal\n- [ ] Min balance: only redeem if ≥100 points\n- [ ] Burn applied at checkout → order total reduced; balance updated\n- [ ] Order refunded → points reversed; ledger entry created\n- [ ] Account page: balance + history displayed; no errors\n- [ ] Loyalty flag OFF → no earn/burn; no surfaces shown\n- [ ] Negative balance prevention: balance never < 0\n- [ ] Email: loyalty message included in confirmation\n- [ ] QA: ON/OFF matrix tested\n\n---\n\n## M6: Search & Performance\n**Timeline**: 2–3 weeks  \n**Priority**: Medium\n\n### Deliverables\n- **Meilisearch integration** (packages/search, if planned; else API fallback):\n  - Meili cluster setup (local or hosted)\n  - Index schema: products, variants\n  - Reindex triggers: on product/price/stock changes\n  - Search query handler (if flag ON)\n  - Fallback to API filter (if flag OFF)\n  - Zero-results logging & suggestions\n\n- **Performance**:\n  - Redis cache: catalog queries (60s TTL), basket (30s TTL)\n  - Next.js ISR: PLP/PDP revalidate 600–1800s\n  - Images: Next/Image optimization, responsive srcsets\n  - Code splitting: dynamic imports for payment/search providers\n  - Core Web Vitals: measure LCP, FID, CLS\n\n- **Cloudflare (optional if cache.edgeEnabled)**:\n  - Surrogate keys: per product, collection\n  - Purge hooks: API plugin triggers purge on changes\n  - RUM: monitor CWV metrics\n\n### Acceptance Criteria\n- [ ] Meilisearch ON: search query returns results <100ms (with typo tolerance)\n- [ ] Meili OFF: fallback to API filter; results correct (no typos handled)\n- [ ] Reindex: product change → index updated within 5s\n- [ ] Redis: catalog queries cached; hit rate >80%\n- [ ] ISR: PDP revalidates on inventory change\n- [ ] Images: Next/Image used for all product photos; responsive\n- [ ] CWV: LCP <2.5s, FID <100ms, CLS <0.1 (75th percentile)\n- [ ] Search flag OFF: fallback search works; acceptable UX\n- [ ] Meili flag ON: full-text + typo tolerance working\n- [ ] CF (if enabled): surrogate key purges working; hit ratio >70%\n- [ ] Benchmarks: see search.md & perf-and-pwa.md acceptance tests\n- [ ] QA: ON/OFF matrix tested\n\n---\n\n## M7: Content Pass (Strapi Blocks + SEO + Legal Pages)\n**Timeline**: 1–2 weeks  \n**Priority**: Medium\n\n### Deliverables\n- **Strapi content**:\n  - Hero blocks, promo bars, featured products, testimonials, FAQ\n  - Editorial flow (draft/publish)\n  - Content pages: About, Shipping & Returns, Privacy, Terms\n\n- **Web integration**:\n  - Content pages fetch from Strapi by slug\n  - Hero/promo blocks render on home/collection pages\n  - ISR on Strapi webhook\n\n- **SEO**:\n  - All pages: title, meta description, OG tags\n  - Structured data: Organization, Product, CollectionPage, WebPage\n  - XML sitemap: home + all collections + content pages\n  - robots.txt: guide crawlers\n\n### Acceptance Criteria\n- [ ] Strapi content pages (About, Terms, Privacy) accessible via web\n- [ ] SEO: all pages have title, meta, OG; structured data valid (JSON-LD)\n- [ ] Sitemap: all product collections & content pages included\n- [ ] ISR: content page change in Strapi → web page revalidates\n- [ ] Footer: legal links (Privacy, Terms) present & functional\n- [ ] Mobile: pages responsive; readable on 320px\n- [ ] Accessibility: WCAG 2.1 AA (headings, alt text, contrast)\n\n---\n\n## M8: Admin UI Elevation (Last Priority)\n**Timeline**: 2–3 weeks  \n**Priority**: Low (non-blocking)\n\n### Deliverables\n- **Dashboard**:\n  - Revenue cards (today's sales, AOV, order count)\n  - Top products, top customers, low stock alerts\n  - Fulfillment backlog, recent refunds\n\n- **Operations views**:\n  - Orders board (Kanban: Paid → Picking → Shipped)\n  - Picking list (print/PDF)\n  - Shipping export monitor (batch status, re-export)\n\n- **Admin extensions**:\n  - Payment timeline: Authorized → Captured → Refunded\n  - Manual capture/refund buttons\n  - Webhook replay (for reconciliation)\n\n- **Reporting**:\n  - CSV export: per widget\n  - Sales/inventory/customer reports\n\n### Acceptance Criteria\n- [ ] Dashboard metrics correct (revenue, AOV, top products)\n- [ ] Orders board: drag-to-transition state changes; filters work\n- [ ] Picking list: generates printable with correct data\n- [ ] Shipping monitor: batch status displayed; re-export works\n- [ ] Payment timeline: all events shown with timestamps\n- [ ] Manual capture: success/failure message; order state updates\n- [ ] Manual refund: full/partial options; ledger entry created\n- [ ] CSV exports: columns match spec; data correct\n- [ ] Role-based access: unauthorized users cannot access\n- [ ] Mobile: views accessible on iPad (responsive)\n- [ ] Accessibility: WCAG 2.1 AA\n\n---\n\n## Core Guarantee (All Milestones)\n\n**\"Browse → Cart → Pay must work even if any optional feature is OFF.\"**\n\nValidate this in each milestone:\n- [ ] All feature flags: OFF\n- [ ] Storefront: home loads, can browse products, add to cart, checkout\n- [ ] Checkout: payment method available (fallback or basic)\n- [ ] Order: created successfully; marked \"Paid\"\n- [ ] No JS errors; no 5xx errors\n\n---\n\n## Release Readiness Checklist\n\nBefore each milestone release:\n- [ ] All acceptance criteria met\n- [ ] Integration tests pass (>80% coverage)\n- [ ] Manual QA checklist completed (qa-checklist.md)\n- [ ] Documentation updated (READMEs, specs, runbooks)\n- [ ] Code review: 2 approvals\n- [ ] Ops runbook tested: team can follow steps\n- [ ] Monitoring/alerts configured\n- [ ] Rollback plan documented\n