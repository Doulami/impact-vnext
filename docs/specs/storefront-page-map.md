# Storefront Page Map\n\n## Route & Page Definitions\n\n### / (Home)\n- **Template**: Hero section + featured products + promo bars\n- **Data Sources**: \n  - Strapi: hero banner, promoBars\n  - Vendure: featured products query, collection highlights\n- **SEO**: Home title, meta description, structured data (Organization)\n- **PWA**: offline fallback to static hero or \"Coming soon\" message\n\n### /search\n- **Template**: Search form + results grid with filters\n- **Data Sources**:\n  - Meili (if `search.meiliEnabled`): full-text query with typo tolerance\n  - API fallback: filter on title, SKU, tags\n- **Filters**: price range, stock status, rating (if available)\n- **SEO**: dynamic title (e.g., \"Search Results for 'protein'\")\n- **Zero results**: logging & synonym suggestions\n\n### /c/[collection]\n- **Template**: Collection banner + PLP (product list) + filters\n- **Data Sources**:\n  - Vendure: collection metadata, products, variants\n  - Strapi: collection description & content blocks (if linked)\n- **Filters**: price, rating, in-stock, tags\n- **SEO**: collection name, description, structured data (CollectionPage)\n- **Pagination**: ISR with 50 products/page\n\n### /p/[handle]\n- **Template**: Product hero + gallery + variant selector + add-to-cart + related products + tabs\n- **Tabs**: Description, Ingredients, Nutrition Facts, Reviews (if enabled)\n- **Data Sources**:\n  - Vendure: product, variants, inventory, pricing\n  - Strapi: detailed ingredients, nutrition, allergen info\n- **Related**: \"You may also like\" via Vendure collection or tag-based\n- **SEO**: product title, description, OG image, structured data (Product)\n- **PWA**: offline cache for PDP shell + product image\n\n### /cart\n- **Template**: Cart summary (drawer or full page) + edit quantities + promo code input\n- **Data Sources**: Vendure active cart query\n- **CTA**: \"Proceed to Checkout\" button\n- **No-cache**: always fetch latest cart state\n\n### /checkout\n- **Multi-step**: Address → Shipping method → Payment\n- **Data flow**:\n  1. Customer enters address (validate via Vendure)\n  2. Fetch shipping methods (Vendure, optionally gated by `shipping.fileBridgeEnabled`)\n  3. Select payment method (Vendure lists available; GPG shown if `payments.gpgEnabled`)\n  4. Create order → redirect to GPG hosted page (if GPG) or process natively\n  5. Webhook confirmation → order confirmation page\n- **No-cache**: never cache, real-time cart/shipping/payment state\n- **Error handling**: clear messaging for payment failures, address validation errors\n\n### /checkout/confirmation\n- **Template**: Order confirmation with order number, items, total, shipping address\n- **Data Sources**: Vendure order query by id\n- **Email**: triggered by order creation webhook (handled server-side)\n- **PWA**: offline unavailable; prompt to save confirmation\n\n### /account\n- **Gated**: login required; redirect to /login if not authenticated\n- **Tabs/Sections**:\n  - Orders: order history, order detail page\n  - Addresses: saved shipping/billing addresses, add/edit/delete\n  - Loyalty (if `loyalty` enabled): points balance, earn/burn history, tier info\n  - Account settings: profile, password, email preferences\n- **Data**: Vendure customer query, orders query, address list\n- **No-cache** for authenticated routes\n\n### /account/login & /account/register\n- **Template**: Email/password form + validation\n- **Social login** (if enabled): OAuth buttons\n- **Data flow**: POST to Vendure customer mutation; set session token\n- **Redirect**: post-login → `/account` or referrer\n\n### /content/[slug]\n- **Template**: CMS page layout (hero + rich text + components)\n- **Data Sources**: Strapi dynamic page fetch by slug\n- **Supported pages**: About, Shipping & Returns, Privacy Policy, Terms of Service, FAQ\n- **SEO**: title, description, structured data (WebPage)\n- **ISR**: revalidate on Strapi webhook\n\n### 404 (Not Found)\n- **Template**: Error message + suggested collections/search link\n- **Log**: 404 requests for analysis\n\n## Data Revalidation (ISR / Edge)\n\n| Route | TTL | Trigger Revalidation |\n|-------|-----|----------------------|\n| `/` | 3600s | Strapi promo bar change, featured product update |\n| `/c/[collection]` | 1800s | Product price/stock change, collection edit |\n| `/p/[handle]` | 600s | Variant/inventory/price change (via API webhook) |\n| `/cart` | 0 (no-cache) | Real-time query |\n| `/checkout/*` | 0 (no-cache) | Real-time query |\n| `/account/*` | 0 (no-cache) | Real-time query (requires auth) |\n| `/content/*` | 3600s | Strapi webhook on publish |\n\n## PWA Requirements\n\n### Manifest\n- **Name**: from Strapi `StoreConfig.branding.siteName`\n- **Description**: from `NEXT_PUBLIC_APP_DESCRIPTION`\n- **Icons**: logo variants (192x192, 512x512)\n- **Theme color**: primary brand color\n- **Display**: standalone\n\n### Service Worker\n- **Scope**: `/`\n- **Offline fallback**: PDP shell + cart shell (from cache)\n- **Stale-while-revalidate**: PLP, home (if flag enabled)\n- **Skip waiting**: no; prompt user to refresh on update\n\n### Install Prompt\n- **Trigger**: after 10s on home page (if `pwa.enabled`)\n- **Messaging**: \"Save to home screen\" button\n- **Dismissal**: remember for 30 days\n\n## Mobile & Responsive\n- **Viewport**: responsive design; mobile-first\n- **Core Web Vitals budget** (if `cache.edgeEnabled`):\n  - LCP: <75ms (PDP)\n  - FID: <100ms\n  - CLS: <0.1\n- **Images**: Next/Image with responsive srcsets, lazy loading\n